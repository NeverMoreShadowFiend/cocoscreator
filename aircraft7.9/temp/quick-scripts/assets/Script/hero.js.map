{"version":3,"sources":["hero.js"],"names":["cc","Class","extends","Component","properties","hero_animation","default","type","Animation","tooltip","gameOverClip","AudioClip","main","require","bulletGroup","onLoad","init","eState","D","commonInfo","gameState","none","hero_index","log","index","res","String","animation_name","self","loader","loadRes","err","prefab","stand","instantiate","node","addChild","getComponent","play","hero_Colliders","getComponents","Collider","loop","length","enabled","onDrag","on","dragMove","offDrag","off","event","isDead","locationv","getLocation","location","parent","convertToNodeSpaceAR","minX","width","maxX","minY","height","maxY","x","y","setPosition","onCollisionEnter","other","tag","group","name","bulletname","deltatime","progressnum","setPowerProgressBar","changeBullet","getUfoBomb","onFinished","audioEngine","playEffect","bulletStop","animState","getAnimationState","isPlaying","destroy","gameOver"],"mappings":"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","file":"hero.js","sourceRoot":"..\\..\\..\\..\\assets\\Script","sourcesContent":["\ncc.Class({\n    extends: cc.Component,\n    \n    properties: () => ({\n\n        hero_animation: {\n            default: null,\n            type: cc.Animation,\n            tooltip: '动画',\n        },\n        \n        gameOverClip: cc.AudioClip,\n        main: {\n            default: null,\n            type: require('main'),\n        },\n        bulletGroup: {\n            default: null,\n            type: require('bulletGroup'),\n        }\n    }),\n    \n    // use this for initialization\n    onLoad: function () {\n        //this.init();\n    },\n\n    init:function(){\n        this.eState = D.commonInfo.gameState.none;\n\n        if(!D.commonInfo.hero_index){\n            cc.log(\"error:not hero_index\");\n            return false;\n        }\n\n        var index = D.commonInfo.hero_index;\n        \n        //正常情况下应该无资源,根据hero_index来初始化\n        var res = \"prefab/hero\" + String(index);\n        var animation_name = \"hero\" + String(index) + \"_stand\"\n        var self = this;\n        cc.loader.loadRes(res, function (err, prefab) {\n            var stand = cc.instantiate(prefab);\n            self.node.addChild(stand);\n            self.hero_animation = stand.getComponent(cc.Animation);\n            self.hero_animation.play(animation_name);\n        });\n        \n        var hero_Colliders = this.getComponents(cc.Collider);\n        for (let loop = 0; loop < hero_Colliders.length; ++loop) {\n           if(loop+1 == index){\n                hero_Colliders[loop].enabled = true;\n           }\n           else {\n                hero_Colliders[loop].enabled = false;\n           }\n        }\n        this.onDrag();\n        \n    },\n\n    //添加拖动监听\n    onDrag: function(){\n        this.node.on('touchmove', this.dragMove, this);\n    },\n    //去掉拖动监听\n    offDrag: function(){ \n         this.node.off('touchmove', this.dragMove, this);\n    },\n    //拖动\n    dragMove: function(event){ \n        if (this.isDead()){\n           return false;\n        }\n        var locationv = event.getLocation();\n        var location = this.node.parent.convertToNodeSpaceAR(locationv);\n        //飞机不移出屏幕 \n        var minX = -this.node.parent.width/2+this.node.width/2;\n        var maxX = -minX;\n        var minY = -this.node.parent.height/2+this.node.height/2;\n        var maxY = -minY;\n        if (location.x< minX){\n            location.x = minX;\n        }\n        if (location.x>maxX){\n            location.x = maxX;\n        }\n        if (location.y< minY){\n            location.y = minY;\n        }\n        if (location.y> maxY){\n            location.y = maxY;\n        }\n        this.node.setPosition(location);\n    },\n    //碰撞监测\n    onCollisionEnter: function(other,self) {\n        if (self.tag != D.commonInfo.hero_index){\n            return false;\n        }\n\n        if (this.isDead()){\n            return false;\n        }\n    \n        if (other.node.group == 'ufo'){\n            if (other.node.name == 'ufoBullet'){\n                this.main.bulletname='ufoBullet';\n                this.main.deltatime=0;\n                if(this.main.progressnum<5){ this.main.progressnum+=1;};\n                this.main.setPowerProgressBar(this.main.progressnum);\n                this.bulletGroup.changeBullet(other.node.name,this.main.progressnum);\n            } else if (other.node.name == 'ufoBomb'){\n                this.main.getUfoBomb();\n            }\n        } else if (other.node.group == 'enemy'){\n            //播放动画\n            var animation_name = \"hero\" + String(D.commonInfo.hero_index) + \"_blowup\";\n            this.hero_animation.play(animation_name);\n            this.hero_animation.on('finished', this.onFinished, this);\n            //播放音效\n            cc.audioEngine.playEffect(this.gameOverClip, false);\n            //停止子弹\n            this.bulletGroup.bulletStop();\n             \n        } else {\n            return false;\n        }\n        \n    },\n\n    isDead: function(){\n        var animation_name = \"hero\" + String(D.commonInfo.hero_index) + \"_blowup\";\n        var animState = this.hero_animation.getAnimationState(animation_name);\n        if (animState){\n            if (animState.isPlaying){\n                return true;\n            }\n        }\n        return false;\n    },\n    \n    onFinished: function() { //动画结束后\n        //清除节点\n        this.node.destroy();\n        //更新分数 \n        this.main.gameOver();  \n        //\n        this.destroy();\n    },\n    // called every frame, uncomment this function to activate update callback\n    // update: function (dt) {\n\n    // },\n});\n"]}